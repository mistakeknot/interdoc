---
name: interdoc
description: Generate or update CLAUDE.md documentation using parallel subagents. Use /interdoc to invoke.
---

# Interdoc: Recursive Documentation Generator

## Purpose

Generate and maintain CLAUDE.md files across a project using parallel subagents. Each subagent documents a directory, and the root agent consolidates into coherent project documentation.

## When to Use

**Manual invocation:**
- `/interdoc` - Generate or update documentation for current project

**Automatic triggers (via hooks):**
- SessionStart: No CLAUDE.md exists, or 3+ commits since last update
- PostToolUse: 10+ commits accumulated mid-session

## Mode Detection

The skill automatically detects which mode to use:

- **No CLAUDE.md exists** → Generation mode (full recursive pass)
- **CLAUDE.md exists** → Update mode (targeted pass on changed directories)

## Generation Mode Workflow

### Step 1: Analyze Project Structure

Explore the project to identify directories that may warrant documentation:

```bash
# Find directories with source files
find . -type f \( -name "*.ts" -o -name "*.js" -o -name "*.py" -o -name "*.go" -o -name "*.rs" -o -name "*.java" \) | xargs dirname | sort -u

# Find package manifests
find . -name "package.json" -o -name "Cargo.toml" -o -name "go.mod" -o -name "pyproject.toml" -o -name "requirements.txt"
```

Build a list of directories to document. Include:
- Root directory (always)
- Directories with package manifests
- Directories with 5+ source files
- Major structural directories (src/, lib/, packages/, apps/)

### Step 2: Spawn Subagents

For each directory identified, spawn a subagent using the Task tool:

```
Task tool with subagent_type="general-purpose":

You are documenting the directory: {path}

Your job is to analyze the code and extract information useful for coding agents.

**Explore the directory:**
- Read source files to understand what they do
- Check for README.md, package.json, or other metadata
- Look at file structure and naming patterns

**Extract and document:**
1. Purpose - What does this directory/package do?
2. Key files - What are the important files and their roles?
3. Architecture - How do components connect? What's the data flow?
4. Conventions - Naming patterns, code style, structural patterns
5. Dependencies - What does this code depend on?
6. Gotchas - Non-obvious behavior, known issues, TODOs worth noting
7. Commands - Build, test, run commands if applicable

**Decide if this directory warrants its own CLAUDE.md:**
- YES if: 5+ source files, has package manifest, or contains significant complexity
- NO if: Simple, few files, or just utilities

**Return your response in this format:**

DIRECTORY: {path}
WARRANTS_CLAUDE_MD: true/false
SUMMARY: [One paragraph summary for parent CLAUDE.md]

PATTERNS_DISCOVERED:
- [Pattern 1]
- [Pattern 2]

CROSS_CUTTING_NOTES:
- [Things that affect other parts of the codebase]

CLAUDE_MD_CONTENT: (only if WARRANTS_CLAUDE_MD is true)
```markdown
# {Directory Name}

## Purpose
...

## Key Files
...

## Architecture
...

## Conventions
...

## Gotchas
...
```
```

**Spawn subagents in parallel** using multiple Task tool calls in a single message.

### Step 3: Collect and Consolidate

After all subagents complete, consolidate their outputs:

**Deduplicate patterns:**
- If multiple subagents report the same convention, include it once in root CLAUDE.md
- Pick the clearest description

**Harmonize terminology:**
- Ensure consistent naming (don't mix "API layer" and "backend services")
- Use terminology from existing README if present

**Identify cross-cutting concerns:**
- Shared types/interfaces used across directories
- Common error handling patterns
- Data flow between packages
- Build/deploy pipeline that spans the project

### Step 4: Build Root CLAUDE.md

Create the root CLAUDE.md with this structure:

```markdown
# CLAUDE.md

## Overview

[What this project does - synthesized from subagent summaries and any existing README]

## Architecture

[How the pieces fit together - cross-cutting concerns, data flow]

## Directory Structure

[Map of key directories with one-line descriptions]
- `/src/api/` - REST API layer (has own CLAUDE.md)
- `/src/core/` - Business logic
- `/packages/shared/` - Shared utilities (has own CLAUDE.md)

## Conventions

[Project-wide patterns - deduplicated from subagents]

## Development

[Build, test, run commands - consolidated from subagents]

## Gotchas

[Project-wide gotchas and known issues]
```

### Step 5: Write Files

For each directory where a subagent indicated WARRANTS_CLAUDE_MD: true:
1. Write the CLAUDE.md file
2. Create AGENTS.md redirect:

```markdown
# Agent Context

For complete documentation, read CLAUDE.md in this directory.

This file exists for Codex CLI compatibility.
```

Write root CLAUDE.md and AGENTS.md.

### Step 6: Commit

```bash
git add -A "*.md"
git commit -m "Generate CLAUDE.md documentation

Created documentation for:
- [list directories with CLAUDE.md]

Generated by Interdoc"
```

## Update Mode Workflow

### Step 1: Detect Changes

Find what changed since last CLAUDE.md update:

```bash
CLAUDE_UPDATE_TIME=$(git log -1 --format=%ct CLAUDE.md)
git diff --name-only "@$CLAUDE_UPDATE_TIME" HEAD
```

Group changed files by directory.

### Step 2: Spawn Targeted Subagents

Only spawn subagents for directories with changes. Modify the prompt:

```
You are updating documentation for: {path}

Recent changes in this directory:
{list of changed files from git diff}

**Read the existing CLAUDE.md** (if present) to understand current documentation.

**Analyze the changes:**
- What functionality was added/modified?
- Do any documented patterns need updating?
- Are there new gotchas or conventions?

**Return your response in this format:**

DIRECTORY: {path}
CHANGES_SUMMARY: [What changed]
UPDATES_NEEDED: true/false

PROPOSED_UPDATES: (if UPDATES_NEEDED is true)
- Section: [section name]
  Change: [add/modify/remove]
  Content: [proposed content]

STALE_CONTENT: (if any existing documentation is now incorrect)
- [Description of what's stale]
```

### Step 3: Present for Approval

Show the user what updates are proposed:

```
Found changes in 2 directories:

1. /src/api/
   - New authentication middleware added
   - Proposed: Add "Authentication" section to CLAUDE.md

2. /src/core/
   - Validation logic refactored
   - Proposed: Update "Architecture" section

Would you like to:
- Review all suggestions
- Apply all
- Skip for now
```

### Step 4: Apply Approved Updates

For each approved update:
1. Read existing CLAUDE.md
2. Apply the modification (preserving other sections)
3. Write updated file

### Step 5: Commit

```bash
git add -A "*.md"
git commit -m "Update CLAUDE.md documentation

Updated:
- [list of changes]

Generated by Interdoc"
```

## Key Principles

1. **Useful for agents** - Document what helps coding agents be effective
2. **Parallel execution** - Spawn subagents concurrently for speed
3. **Human approval** - User approves all changes in update mode
4. **Preserve customizations** - Don't overwrite user edits in update mode
5. **Cross-AI compatible** - Maintain AGENTS.md redirects for Codex CLI

## Example Session

### Generation (new project)

```
User: /interdoc

Claude: I'll generate CLAUDE.md documentation for this project.

Analyzing project structure...
Found 4 directories to document:
- / (root)
- /src/api/
- /src/core/
- /packages/shared/

Spawning subagents to analyze each directory...

[Subagents run in parallel]

Consolidation complete. Created:
- /CLAUDE.md (root documentation)
- /src/api/CLAUDE.md
- /packages/shared/CLAUDE.md
- AGENTS.md redirects for each

Committed: "Generate CLAUDE.md documentation"
```

### Update (existing project)

```
User: /interdoc

Claude: CLAUDE.md exists. Checking for changes since last update...

Found 5 commits affecting 2 directories:
- /src/api/ (3 files changed)
- /src/core/ (2 files changed)

Analyzing changes...

Proposed updates:

1. /src/api/CLAUDE.md
   Add section: "Rate Limiting"
   - New rate limiting middleware in middleware/rateLimit.ts
   - Configurable via RATE_LIMIT_* env vars

2. Root CLAUDE.md
   Update section: "Architecture"
   - Add mention of rate limiting layer

Apply these updates? (yes/review/skip)
```
